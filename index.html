<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grip Studio - Flash Product Image Management</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        body { font-family: 'Pretendard', sans-serif; -webkit-tap-highlight-color: transparent; }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="bg-gray-900 min-h-screen flex flex-col items-center justify-center p-4 gap-4">

    <!-- 개발/기획 검증용 모드 전환 스위치 -->
    <div class="flex gap-2 bg-white p-2 rounded-2xl shadow-lg border border-white/20 z-10">
        <button id="mode-register" class="px-6 py-2 rounded-xl text-sm font-bold transition-all bg-pink-500 text-white shadow-md">신규 등록 모드</button>
        <button id="mode-edit" class="px-6 py-2 rounded-xl text-sm font-bold transition-all bg-gray-100 text-gray-500 hover:bg-gray-200">수정 모드</button>
    </div>

    <!-- 메인 팝업 컨테이너 -->
    <div class="bg-white w-full max-w-md rounded-[32px] overflow-hidden shadow-2xl">
        <!-- 헤더 -->
        <div class="flex items-center justify-between p-6 border-b border-gray-50">
            <h1 id="popup-title" class="text-lg font-bold text-center flex-1">플래시 상품 등록</h1>
            <button class="text-gray-400 hover:bg-gray-100 p-2 rounded-full transition-colors">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
        </div>

        <div class="p-6">
            <!-- 대표 사진 섹션 -->
            <div class="flex items-center gap-1 mb-4">
                <span class="text-base font-bold text-black">대표사진</span>
                <span class="text-red-500 font-bold">*</span>
            </div>

            <!-- 메인 미리보기 창 -->
            <div class="relative w-full aspect-square bg-gray-50 rounded-2xl overflow-hidden mb-5 border border-gray-100">
                <div id="main-preview-container" class="w-full h-full">
                    <!-- JS에서 렌더링 -->
                </div>
                
                <!-- 하단 제어 버튼 -->
                <div class="absolute bottom-4 left-0 right-0 flex justify-center gap-2 px-6">
                    <button id="btn-upload" class="flex-1 bg-white/95 backdrop-blur py-3 rounded-xl text-sm font-bold shadow-md border border-gray-100 flex items-center justify-center gap-2 hover:bg-white transition-all active:scale-95">
                        <i data-lucide="upload" class="w-4 h-4"></i> 파일 업로드
                    </button>
                    <button id="btn-capture" class="flex-1 bg-black/85 text-white py-3 rounded-xl text-sm font-bold shadow-md flex items-center justify-center gap-2 hover:bg-black transition-all active:scale-95">
                        <i data-lucide="camera" class="w-4 h-4"></i> 현재 화면 캡처
                    </button>
                </div>
            </div>

            <!-- 썸네일 리스트 -->
            <div id="thumbnail-list" class="flex gap-2.5 mb-2">
                <!-- JS에서 렌더링 -->
            </div>
            <p class="text-[11px] text-gray-400 mb-6">· 1:1 비율 (비율이 다를 경우 자동 반영됩니다.)</p>

            <!-- 대표 사진 변경 제어 바 -->
            <div id="main-control-bar">
                <!-- JS에서 렌더링 -->
            </div>

            <!-- 상품 정보 입력 영역 -->
            <div class="space-y-5">
                <div>
                    <label class="block text-sm font-bold mb-2.5 text-gray-900">상품 정보 <span class="text-red-500 font-bold">*</span></label>
                    <input type="text" id="input-name" placeholder="판매할 상품명을 입력해주세요" class="w-full p-4 border border-gray-200 rounded-2xl text-sm focus:outline-none focus:ring-2 focus:ring-pink-500/20 focus:border-pink-500 transition-all bg-white" />
                </div>
                
                <div class="flex gap-4">
                    <div class="flex-1">
                        <label class="block text-sm font-bold mb-2.5 text-gray-900">수량 <span class="text-red-500 font-bold">*</span></label>
                        <div class="relative group">
                            <input type="number" id="input-stock" placeholder="0" class="w-full p-4 border border-gray-200 rounded-2xl text-sm pr-10 focus:outline-none focus:ring-2 focus:ring-pink-500/20 focus:border-pink-500 transition-all bg-white" />
                            <span class="absolute right-4 top-4 text-sm text-gray-400">개</span>
                        </div>
                    </div>
                    <div class="flex-1">
                        <label class="block text-sm font-bold mb-2.5 text-gray-900">가격 <span class="text-red-500 font-bold">*</span></label>
                        <div class="relative group">
                            <input type="number" id="input-price" placeholder="0" class="w-full p-4 border border-gray-200 rounded-2xl text-sm pr-10 focus:outline-none focus:ring-2 focus:ring-pink-500/20 focus:border-pink-500 transition-all bg-white" />
                            <span class="absolute right-4 top-4 text-sm text-gray-400">원</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 푸터 액션 -->
            <div class="flex gap-3 mt-10">
                <button class="flex-1 bg-gray-100 text-gray-600 py-4 rounded-2xl font-bold hover:bg-gray-200 transition-colors active:scale-95">취소</button>
                <button id="btn-submit" class="flex-1 bg-[#ff3b5c] text-white py-4 rounded-2xl font-bold shadow-lg shadow-pink-200 hover:bg-[#e63552] transition-all active:scale-95">적용</button>
            </div>
        </div>
    </div>

    <!-- 숨겨진 파일 인풋 -->
    <input type="file" id="hidden-file-input" class="hidden" accept="image/*" />

    <script>
        // --- 상태 관리 ---
        let state = {
            mode: 'register',
            images: [
                { id: 1, url: 'https://images.unsplash.com/photo-1509042239860-f550ce710b93?w=400', isMain: true },
                { id: 2, url: 'https://images.unsplash.com/photo-1559056199-641a0ac8b55e?w=400', isMain: false },
                { id: 3, url: 'https://images.unsplash.com/photo-1504113891439-59917cbb776b?w=400', isMain: false },
            ],
            selectedIndex: 0,
            productInfo: { name: '', stock: '', price: '' }
        };

        // --- 렌더링 함수 ---
        function render() {
            // 1. 헤더 및 버튼 텍스트
            document.getElementById('popup-title').innerText = state.mode === 'register' ? '플래시 상품 등록' : '플래시 상품 수정';
            document.getElementById('btn-submit').innerText = state.mode === 'register' ? '적용' : '수정 완료';

            // 2. 모드 버튼 스타일
            const regBtn = document.getElementById('mode-register');
            const editBtn = document.getElementById('mode-edit');
            if (state.mode === 'register') {
                regBtn.className = "px-6 py-2 rounded-xl text-sm font-bold transition-all bg-pink-500 text-white shadow-md";
                editBtn.className = "px-6 py-2 rounded-xl text-sm font-bold transition-all bg-gray-100 text-gray-500 hover:bg-gray-200";
            } else {
                regBtn.className = "px-6 py-2 rounded-xl text-sm font-bold transition-all bg-gray-100 text-gray-500 hover:bg-gray-200";
                editBtn.className = "px-6 py-2 rounded-xl text-sm font-bold transition-all bg-pink-500 text-white shadow-md";
            }

            // 3. 메인 미리보기
            const previewContainer = document.getElementById('main-preview-container');
            if (state.images.length > 0) {
                const selectedImg = state.images[state.selectedIndex];
                previewContainer.innerHTML = `<img src="${selectedImg.url}" class="w-full h-full object-cover fade-in" alt="Preview" />`;
            } else {
                previewContainer.innerHTML = `
                    <div class="w-full h-full flex flex-col items-center justify-center text-gray-400">
                        <i data-lucide="image" class="w-12 h-12 mb-2"></i>
                        <p class="text-sm">사진을 등록해 주세요</p>
                    </div>
                `;
            }

            // 4. 썸네일 리스트
            const thumbList = document.getElementById('thumbnail-list');
            thumbList.innerHTML = '';
            for (let i = 0; i < 5; i++) {
                const thumb = document.createElement('div');
                const imgData = state.images[i];
                const isActive = state.selectedIndex === i;
                
                thumb.className = `relative w-16 h-16 rounded-xl border-2 cursor-pointer transition-all duration-200 ${
                    isActive ? 'border-blue-500 ring-2 ring-blue-100 scale-105' : 'border-transparent bg-gray-50'
                }`;

                if (imgData) {
                    thumb.innerHTML = `
                        <div class="w-full h-full relative group">
                            <img src="${imgData.url}" class="w-full h-full object-cover rounded-[10px]" />
                            <button onclick="deleteImage(event, ${i})" class="absolute -top-1.5 -right-1.5 bg-gray-900 text-white rounded-full p-0.5 border border-white shadow-sm opacity-0 group-hover:opacity-100 transition-opacity">
                                <i data-lucide="x" class="w-3 h-3"></i>
                            </button>
                            ${imgData.isMain ? '<div class="absolute top-0 left-0 bg-indigo-600 text-white text-[9px] px-1.5 py-0.5 rounded-br-lg rounded-tl-[8px] font-bold shadow-sm">대표</div>' : ''}
                        </div>
                    `;
                    thumb.onclick = () => { state.selectedIndex = i; render(); };
                } else {
                    thumb.innerHTML = `<div class="w-full h-full flex items-center justify-center text-gray-300 hover:text-gray-400"><i data-lucide="image" class="w-5 h-5"></i></div>`;
                    thumb.onclick = handleAddImage;
                }
                thumbList.appendChild(thumb);
            }

            // 5. 대표 사진 제어 바
            const controlBar = document.getElementById('main-control-bar');
            if (state.images.length > 0) {
                const selectedImg = state.images[state.selectedIndex];
                controlBar.innerHTML = `
                    <div class="p-4 rounded-2xl flex items-center justify-between mb-8 border transition-all ${
                        selectedImg.isMain ? 'bg-gray-50 border-gray-100' : 'bg-blue-50 border-blue-100 shadow-sm'
                    }">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-lg overflow-hidden bg-white border border-gray-200 shadow-inner">
                                <img src="${selectedImg.url}" class="w-full h-full object-cover" />
                            </div>
                            <p class="text-xs font-semibold ${selectedImg.isMain ? 'text-gray-600' : 'text-blue-800'}">
                                ${selectedImg.isMain ? '현재 대표 사진입니다' : '이 사진을 대표로 지정할까요?'}
                            </p>
                        </div>
                        ${!selectedImg.isMain ? `<button onclick="setAsMain()" class="bg-blue-600 text-white text-xs px-4 py-2 rounded-xl font-bold hover:bg-blue-700 active:scale-95 transition-all">대표로 설정</button>` : ''}
                    </div>
                `;
            } else {
                controlBar.innerHTML = '';
            }

            // 6. 입력값 (수정 모드일 때만 처음 한 번 반영하는 로직은 별도 처리)
            // 여기서는 단순 상태 유지
            document.getElementById('input-name').value = state.productInfo.name;
            document.getElementById('input-stock').value = state.productInfo.stock;
            document.getElementById('input-price').value = state.productInfo.price;

            // Lucide 아이콘 다시 그리기
            lucide.createIcons();
        }

        // --- 액션 함수 ---
        function setMode(newMode) {
            state.mode = newMode;
            if (newMode === 'edit') {
                state.productInfo = { name: '이미 등록된 커피 세트', stock: '50', price: '15000' };
            } else {
                state.productInfo = { name: '', stock: '', price: '' };
            }
            render();
        }

        function handleAddImage() {
            if (state.images.length >= 5) {
                alert("최대 5개까지 등록 가능합니다.");
                return;
            }
            // 더미 이미지 추가
            const newImg = {
                id: Date.now(),
                url: 'https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?w=400',
                isMain: state.images.length === 0
            };
            state.images.push(newImg);
            state.selectedIndex = state.images.length - 1;
            render();
        }

        function deleteImage(e, index) {
            e.stopPropagation();
            const wasMain = state.images[index].isMain;
            state.images.splice(index, 1);
            
            // 인덱스 보정
            if (state.selectedIndex >= state.images.length) {
                state.selectedIndex = Math.max(0, state.images.length - 1);
            }

            // 대표 사진이 삭제된 경우 첫 번째를 자동으로
            if (wasMain && state.images.length > 0) {
                state.images[0].isMain = true;
            }
            render();
        }

        function setAsMain() {
            state.images.forEach((img, idx) => {
                img.isMain = (idx === state.selectedIndex);
            });
            render();
        }

        function handleInputChange() {
            state.productInfo.name = document.getElementById('input-name').value;
            state.productInfo.stock = document.getElementById('input-stock').value;
            state.productInfo.price = document.getElementById('input-price').value;
        }

        // --- 초기화 ---
        window.onload = () => {
            // 이벤트 바인딩
            document.getElementById('mode-register').onclick = () => setMode('register');
            document.getElementById('mode-edit').onclick = () => setMode('edit');
            document.getElementById('btn-capture').onclick = handleAddImage;
            document.getElementById('btn-upload').onclick = () => document.getElementById('hidden-file-input').click();
            document.getElementById('btn-submit').onclick = () => alert(state.mode === 'register' ? '등록되었습니다.' : '수정되었습니다.');
            
            // 인풋 실시간 반영
            document.getElementById('input-name').oninput = handleInputChange;
            document.getElementById('input-stock').oninput = handleInputChange;
            document.getElementById('input-price').oninput = handleInputChange;

            render();
        };
    </script>
</body>
</html>
